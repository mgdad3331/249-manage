<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management System</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<header class="bg-gradient d-flex align-items-center p-3 mb-4" style="background: linear-gradient(90deg,#2a9df4,#ff8a33);">
    <img src="https://i.ibb.co/8nNk7gxX/logo-removebg-preview-1.png" alt="Logo" height="50" class="me-3">
    <div>
        <h1 class="h4 text-white mb-0">Management System</h1>
        <small class="text-white-50">لوحة متابعة العملاء والإجراءات</small>
    </div>
</header>

<main class="container">

    <div class="table-responsive shadow-sm rounded">
        <table class="table table-striped table-hover align-middle" id="client-table">
            <thead class="table-primary">
                <tr>
                    {% for col in clients[0].keys() %}
                        {% if col == 'Name' %}
                            <th class="text-start">{{ col }}</th>
                        {% else %}
                            <th class="text-center">{{ col }}</th>
                        {% endif %}
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for client in clients %}
                <tr data-row="{{ loop.index0 }}">
                    {% for col, val in client.items() %}
                        {% if col in tick_columns %}
                            <td class="text-center">
                                <input type="checkbox" class="form-check-input" disabled {% if val == "TRUE" %}checked{% endif %}>
                            </td>
                        {% else %}
                            {% if col == 'Name' %}
                                <td class="text-start">
                                    <div class="d-flex flex-column">
                                        <strong>{{ val }}</strong>

                                        {% if loop.index0 == 0 %}
                                        <button class="btn btn-outline-primary btn-sm mt-2 align-self-start"
                                                onclick="addClient()">➕ إضافة عميل جديد</button>
                                        {% endif %}
                                    </div>
                                </td>
                            {% else %}
                                <td class="text-center">{{ val }}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</main>

<!-- Bootstrap JS Bundle (Optional for responsive features) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Script Add Client -->
<script>
function addClient(){
    let pwd = prompt("أدخل كلمة سر الأدمن لإضافة عميل جديد:");
    if(!pwd) return;
    fetch('/add_client', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({password: pwd})
    })
    .then(r=>r.json())
    .then(d=>{
        if(d.status === 'success'){
            alert('تمت إضافة عميل جديد ✅');
            location.reload();
        } else {
            alert('فشل الإضافة: ' + (d.message || 'خطأ'));
        }
    })
    .catch(e=>{
        console.error(e);
        alert('حدث خطأ أثناء الإرسال');
    });
}
</script>

</body>
</html>
