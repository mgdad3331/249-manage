<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Client Management</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    padding: 20px;
}
table {
    width: 100%;
    border-collapse: collapse;
    background: white;
}
th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
}
th {
    background: #2a9df4;
    color: white;
}
tr:nth-child(even) {
    background: #f9f9f9;
}
input[type=checkbox] {
    transform: scale(1.3);
}
.readonly {
    pointer-events: none;
    opacity: 0.6;
}
.add-row td {
    background: white;
    font-weight: bold;
    cursor: pointer;
}
.add-row:hover td {
    background: #eee;
}
button {
    padding: 8px 20px;
    margin-top: 15px;
}
    .add-client-inline {
    width: 100%;
    padding: 10px;
    background: #fff;
    border: 1px dashed #ccc;
    color: #555;
    text-align: left;
    cursor: pointer;
}

.add-client-inline:hover {
    background: #f4f6f8;
}

</style>
</head>

<body>

<h2 style="text-align:center">Client Management System</h2>

<table id="table">
<thead>
<tr>
    {% for col in clients[0].keys() %}
    {% if col == 'Name' %}
        <th style="width:300px;">{{ col }}</th>
    {% else %}
        <th>{{ col }}</th>
    {% endif %}
{% endfor %}

</tr>
</thead>

<tbody>
{% for client in clients %}
<tr data-row="{{ loop.index0 }}">
{% for col, val in client.items() %}
    {% if col in tick_columns %}
        <td>
            <input type="checkbox"
                   class="tick readonly"
                   data-col="{{ col }}"
                   {% if val=="TRUE" %}checked{% endif %}>
        </td>
    {% else %}
        <td contenteditable="false"
            class="text readonly"
            data-col="{{ col }}">
            {{ val }}
        </td>
    {% endif %}
{% endfor %}
</tr>
{% endfor %}
    <tr>
    {% for col in clients[0].keys() %}
        {% if col == 'Name' %}
            <td>
                <button class="add-client-inline">
                    Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                </button>
            </td>
        {% else %}
            <td></td>
        {% endif %}
    {% endfor %}
</tr>



</tbody>
</table>

<div style="text-align:center">
<button onclick="save()" id="saveBtn" style="display:none">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
</div>

<script>
let admin = false;
let password = "";

function enableEdit(){
    password = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø£Ø¯Ù…Ù†:");
    if(!password) return;

    admin = true;
    document.querySelectorAll(".readonly").forEach(e=>{
        e.classList.remove("readonly");
        if(e.classList.contains("text")){
            e.contentEditable = true;
        }
    });
    document.getElementById("saveBtn").style.display="inline";
}

function save(){
    let updates = {};
    document.querySelectorAll("tr[data-row]").forEach(row=>{
        let r = row.dataset.row;
        updates[r]={};

        row.querySelectorAll(".tick").forEach(cb=>{
            updates[r][cb.dataset.col] = cb.checked ? "TRUE":"FALSE";
        });

        row.querySelectorAll(".text").forEach(td=>{
            updates[r][td.dataset.col] = td.innerText.trim();
        });
    });

    fetch("/save",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({password,updates})
    }).then(r=>r.json()).then(d=>{
        if(d.status=="success"){
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…");
            location.reload();
        } else {
            alert("ÙØ´Ù„ âŒ");
        }
    });
}

function addClient(){
    if(!admin){
        alert("ÙÙ‚Ø· Ø§Ù„Ø£Ø¯Ù…Ù† ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ø¥Ø¶Ø§ÙØ©");
        return;
    }
    fetch("/add_client",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({password})
    }).then(()=>location.reload());
}
</script>

</body>
</html>
